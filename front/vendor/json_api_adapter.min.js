/*! 
 * ember-json-api
 * Built on 2014-07-03
 * http://github.com/daliwali/ember-json-api
 * Copyright (c) 2014 Dali Zheng
 */
(function(){"use strict";var a=Ember.get,b=Ember.isNone;DS.JsonApiSerializer=DS.RESTSerializer.extend({extractSingle:function(a,b,c,d,e){var f;f=this.keyForAttribute?this.keyForAttribute(b.typeKey):b.typeKey;var g={};for(var h in c){var i=Ember.String.singularize(h);i===f&&Ember.isArray(c[h])?g[i]=c[h][0]:g[h]=c[h]}return this._super(a,b,g,d,e)},normalize:function(a,b,c){var d={};for(var e in b)if("links"!==e)d[e]=b[e];else if("object"==typeof b[e])for(var f in b[e])d[f]=b[e][f];return this._super(a,d,c)},normalizePayload:function(a){return a.meta&&(this.extractMeta(a.meta),delete a.meta),a.links&&(this.extractLinks(a.links),delete a.links),a.linked&&(this.extractLinked(a.linked),delete a.linked),a},extractLinked:function(b){var c,d,e,f,g=a(this,"store");for(c in b){d=b[c];for(var h=d.length-1;h>=0;h--)if(e=d[h],e.links){for(f in e.links)e[f]=e.links[f];delete e.links}}g.pushPayload(b)},extractMeta:function(){},extractLinks:function(a){var b,c,d,e,f,g,h=[];for(b in a)c=b.split(".").pop(),d=a[b],"string"==typeof d?e=d:(c=d.type||c,e=d.href),"http"===e.substr(0,4).toLowerCase()&&(e=e.split("//").pop().split("/").slice(1).join("/")),"/"===e.charAt(0)&&(e=e.substr(1)),f={},g=Ember.String.singularize(c),f[g]=e,h.push(f),DS._routes[g]=e;return h},serializeBelongsTo:function(c,d,e){var f=e.key,g=a(c,f);b(g)||(d.links=d.links||{},d.links[f]=a(g,"id"))},serializeHasMany:function(b,c,d){var e=d.key,f=DS.RelationshipChange.determineRelationshipType(b.constructor,d);("manyToNone"===f||"manyToMany"===f)&&(c.links=c.links||{},c.links[e]=a(b,e).mapBy("id"))}})}).call(this),function(){"use strict";function a(a,b,c){this.status=a,this.message=b,this.xhr=c,this.stack=(new Error).stack}var b=Ember.get;DS._routes=Ember.create(null),DS.JsonApiAdapter=DS.RESTAdapter.extend({defaultSerializer:"DS/jsonApi",buildURL:function(a,c){var d=DS._routes[a];if(d){var e=[],f=b(this,"host"),g=this.urlPrefix(),h=/\{(.*?)\}/g;return c?h.test(d)?e.push(d.replace(h,c)):e.push(d,c):e.push(d.replace(h,"")),g&&e.unshift(g),e=e.join("/"),!f&&e&&(e="/"+e),e}return this._super(a,c)},findMany:function(a,b,c){return this.ajax(this.buildURL(b.typeKey,c.join(",")),"GET")},createRecord:function(a,b,c){var d={};return d[this.pathForType(b.typeKey)]=[a.serializerFor(b.typeKey).serialize(c,{includeId:!0})],this.ajax(this.buildURL(b.typeKey),"POST",{data:d})},updateRecord:function(a,c,d){var e={};e[this.pathForType(c.typeKey)]=[a.serializerFor(c.typeKey).serialize(d)];var f=b(d,"id");return this.ajax(this.buildURL(c.typeKey,f),"PUT",{data:e})},_tryParseErrorResponse:function(a){try{return Ember.$.parseJSON(a)}catch(b){return"Something went wrong"}},ajaxError:function(b){var c,d=this._super(b);if(b&&"object"==typeof b){c=this._tryParseErrorResponse(b.responseText);var e={};return c&&"object"==typeof c&&void 0!==c.errors&&Ember.A(Ember.keys(c.errors)).forEach(function(a){e[Ember.String.camelize(a)]=c.errors[a]}),422===b.status?new DS.InvalidError(e):new a(b.status,c,b)}return d},serializeIntoHash:function(a,b,c,d){var e=underscore(decamelize(b.typeKey));a[e]=this.serialize(c,d)}}),a.prototype=Ember.create(Error.prototype),a.constructor=a,DS.JsonApiAdapter.ServerError=a}.call(this);